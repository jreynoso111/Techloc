<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TechLoc • Home</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
        },
      },
    };
  </script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="min-h-screen bg-slate-950 font-sans text-slate-50">
  <header class="sticky top-0 z-50 border-b border-slate-800 bg-slate-950/90 backdrop-blur">
    <div class="mx-auto flex max-w-7xl items-center justify-between px-6 py-4">
      <a href="index.html" class="flex items-center gap-3">
        <div class="flex h-11 w-11 items-center justify-center rounded-2xl bg-gradient-to-br from-blue-500 via-indigo-500 to-blue-700 shadow-lg shadow-blue-500/30">
          <span class="text-sm font-black uppercase tracking-[0.2em] text-white">TL</span>
        </div>
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.18em] text-blue-200">TechLoc Network</p>
          <h1 class="text-lg font-black leading-tight text-white">GPS Installer Hub</h1>
        </div>
      </a>
      <nav class="hidden items-center gap-2 text-sm font-semibold text-slate-200 md:flex">
        <a href="index.html" class="rounded-full px-3 py-1 bg-blue-600 text-white shadow shadow-blue-500/20">Home</a>
        <a href="vehicles.html" class="rounded-full px-3 py-1 transition-colors hover:text-white hover:bg-slate-800">Vehicles to Fix</a>
        <a href="Admin/index.html" class="rounded-full px-3 py-1 transition-colors hover:text-white hover:bg-slate-800">Dashboard</a>
      </nav>
      <div class="hidden items-center gap-2 rounded-full border border-slate-800 bg-slate-900/70 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-300 md:flex">
        <span class="flex h-2 w-2 rounded-full bg-emerald-400"></span> Live coverage
      </div>
    </div>
  </header>

  <canvas id="constellation-canvas" class="pointer-events-none fixed inset-0 -z-10"></canvas>

  <main class="space-y-16">
    <section class="relative overflow-hidden bg-gradient-to-br from-slate-900 via-slate-950 to-slate-900 py-16">
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(59,130,246,0.12),_transparent_35%)]"></div>
      <div class="mx-auto grid max-w-7xl items-center gap-12 px-6 lg:grid-cols-2">
        <div class="space-y-6">
          <div class="inline-flex items-center gap-2 rounded-full border border-slate-800/60 bg-slate-900/60 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-blue-200">
            <i data-lucide="shield" class="h-3 w-3"></i> Nationwide coverage • SLA in minutes
          </div>
          <h2 class="text-4xl font-black leading-tight text-white sm:text-5xl">Welcome to TechLoc</h2>
          <p class="text-lg text-slate-300">Manage your GPS inventory with a verified network of installers. Start by assigning the nearest tech or checking which vehicles with broken GPS units already have nearby support.</p>
          <div class="grid gap-4">
            <a href="vehicles.html" class="flex items-center justify-between rounded-2xl border border-emerald-700/50 bg-emerald-600/10 p-4 text-left shadow-lg shadow-emerald-600/10 transition hover:-translate-y-0.5 hover:border-emerald-400 hover:bg-emerald-600/20">
              <div>
                <p class="text-xs font-semibold uppercase tracking-wide text-emerald-200">Operational map</p>
                <p class="text-lg font-black text-white">Vehicles to fix</p>
                <p class="text-sm text-emerald-100/80">Check coverage and assign nearby technicians.</p>
              </div>
              <i data-lucide="compass" class="h-8 w-8 text-emerald-200"></i>
            </a>
          </div>
          <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
            <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-inner shadow-slate-900">
              <p id="tech-count" class="text-3xl font-black text-white">-</p>
              <p class="text-xs font-semibold uppercase tracking-wide text-slate-400">Registered technicians</p>
            </div>
            <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-inner shadow-slate-900">
              <p id="available-count" class="text-3xl font-black text-green-400">-</p>
              <p class="text-xs font-semibold uppercase tracking-wide text-slate-400">Available now</p>
            </div>
            <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-inner shadow-slate-900">
              <p id="states-count" class="text-3xl font-black text-amber-300">-</p>
              <p class="text-xs font-semibold uppercase tracking-wide text-slate-400">States covered</p>
            </div>
          </div>
        </div>
        <div class="relative overflow-hidden rounded-3xl border border-slate-800/70 bg-slate-900/30 p-8 shadow-2xl shadow-blue-500/10 backdrop-blur-xl">
          <div class="absolute inset-0 bg-gradient-to-br from-blue-500/15 via-transparent to-indigo-500/15"></div>
          <div class="relative space-y-6 text-sm text-slate-300">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs font-semibold uppercase tracking-wide text-slate-400">Service level</p>
                <p id="avg-rating" class="text-3xl font-black text-white">-</p>
              </div>
              <div class="flex items-center gap-2 rounded-full bg-slate-800/60 px-3 py-1 text-xs font-semibold text-emerald-200">
                <i data-lucide="clock" class="h-4 w-4"></i> Dispatch time <span class="font-black text-white">&lt; 15 min</span>
              </div>
            </div>
            <div class="rounded-2xl bg-slate-950/30 p-5 ring-1 ring-slate-800/70 backdrop-blur-lg">
              <h3 class="mb-2 text-sm font-bold text-white">Available workflows</h3>
              <p class="text-sm text-slate-400">Open “Vehicles to Fix” to see vehicles with damaged GPS units, check coverage, and assign the best technician nearby.</p>
            </div>
            <div class="grid grid-cols-2 gap-3 text-xs text-slate-300">
              <div class="flex items-center gap-2 rounded-xl border border-slate-800/70 bg-slate-900/40 px-3 py-2 backdrop-blur">
                <i data-lucide="check-circle" class="h-4 w-4 text-green-400"></i> Background-checked
              </div>
              <div class="flex items-center gap-2 rounded-xl border border-slate-800/70 bg-slate-900/40 px-3 py-2 backdrop-blur">
                <i data-lucide="phone" class="h-4 w-4 text-blue-400"></i> Direct contact
              </div>
              <div class="flex items-center gap-2 rounded-xl border border-slate-800/70 bg-slate-900/40 px-3 py-2 backdrop-blur">
                <i data-lucide="map-pin" class="h-4 w-4 text-amber-300"></i> Precise ETA
              </div>
              <div class="flex items-center gap-2 rounded-xl border border-slate-800/70 bg-slate-900/40 px-3 py-2 backdrop-blur">
                <i data-lucide="wrench" class="h-4 w-4 text-purple-300"></i> Device-specific SOP
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="mx-auto max-w-7xl px-6">
      <div class="grid gap-4 rounded-3xl border border-slate-900 bg-slate-950/60 p-6 shadow-inner shadow-slate-900 sm:grid-cols-2">
        <div class="space-y-2">
          <p class="text-xs font-semibold uppercase tracking-wide text-blue-300">Home</p>
          <h3 class="text-2xl font-black text-white">Choose where to start</h3>
          <p class="text-sm text-slate-400">Head straight into the vehicles map to validate coverage and assign nearby installers.</p>
        </div>
        <div class="grid gap-3">
          <a href="vehicles.html" class="group rounded-2xl border border-slate-800 bg-slate-900/70 p-4 transition hover:-translate-y-0.5 hover:border-emerald-400">
            <div class="mb-2 flex items-center justify-between">
              <span class="text-xs font-semibold uppercase tracking-wide text-emerald-200">Validate</span>
              <i data-lucide="compass" class="h-4 w-4 text-emerald-200"></i>
            </div>
            <p class="text-sm font-semibold text-white">Map of vehicles with issues</p>
            <p class="text-xs text-slate-400">Confirm which customers are near active installers.</p>
          </a>
          <a href="Admin/index.html" class="group rounded-2xl border border-slate-800 bg-slate-900/70 p-4 transition hover:-translate-y-0.5 hover:border-blue-400">
            <div class="mb-2 flex items-center justify-between">
              <span class="text-xs font-semibold uppercase tracking-wide text-blue-200">Secure</span>
              <i data-lucide="shield" class="h-4 w-4 text-blue-200"></i>
            </div>
            <p class="text-sm font-semibold text-white">Admin dashboard</p>
            <p class="text-xs text-slate-400">Manage CSV data, technicians, and vehicles from a protected workspace.</p>
          </a>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-t border-slate-900 bg-slate-950/80 py-6">
    <div class="mx-auto flex max-w-7xl flex-col gap-2 px-6 text-sm text-slate-500 sm:flex-row sm:items-center sm:justify-between">
      <div class="flex items-center gap-2 text-slate-300">
        <i data-lucide="navigation" class="h-4 w-4 text-blue-400"></i>
        <span class="font-semibold text-white">TechLoc</span>
        <span class="text-slate-500">• GPS installer network across the USA</span>
      </div>
      <div class="flex items-center gap-4 text-xs uppercase tracking-wide text-slate-500">
        <span>24/7 Support</span>
        <span>Data security</span>
        <span>Reliable operations</span>
      </div>
    </div>
  </footer>

  <script type="module">
    import { createConstellationBackground } from './assets/constellation.js';

    const STATE_COORDS = {
      AL: { lat: 32.8067, lng: -86.7911 }, AK: { lat: 61.3707, lng: -152.4044 }, AZ: { lat: 33.7298, lng: -111.4312 },
      AR: { lat: 34.9697, lng: -92.3731 }, CA: { lat: 36.1162, lng: -119.6816 }, CO: { lat: 39.0598, lng: -105.3111 },
      CT: { lat: 41.5978, lng: -72.7554 }, DE: { lat: 39.3185, lng: -75.5071 }, FL: { lat: 27.7663, lng: -81.6868 },
      GA: { lat: 33.0406, lng: -83.6431 }, HI: { lat: 21.0943, lng: -157.4983 }, ID: { lat: 44.2405, lng: -114.4788 },
      IL: { lat: 40.3495, lng: -88.9861 }, IN: { lat: 39.8494, lng: -86.2583 }, IA: { lat: 42.0115, lng: -93.2105 },
      KS: { lat: 38.5266, lng: -96.7265 }, KY: { lat: 37.6681, lng: -84.6701 }, LA: { lat: 31.1695, lng: -91.8678 },
      ME: { lat: 44.6939, lng: -69.3819 }, MD: { lat: 39.0639, lng: -76.8021 }, MA: { lat: 42.2302, lng: -71.5301 },
      MI: { lat: 43.3266, lng: -84.5361 }, MN: { lat: 45.6945, lng: -93.9002 }, MS: { lat: 32.7416, lng: -89.6787 },
      MO: { lat: 38.4561, lng: -92.2884 }, MT: { lat: 46.9219, lng: -110.4544 }, NE: { lat: 41.1254, lng: -98.2681 },
      NV: { lat: 38.3135, lng: -117.0554 }, NH: { lat: 43.4525, lng: -71.5639 }, NJ: { lat: 40.2989, lng: -74.521 },
      NM: { lat: 34.8405, lng: -106.2485 }, NY: { lat: 42.1657, lng: -74.9481 }, NC: { lat: 35.6301, lng: -79.8064 },
      ND: { lat: 47.5289, lng: -99.784 }, OH: { lat: 40.3888, lng: -82.7649 }, OK: { lat: 35.5653, lng: -96.9289 },
      OR: { lat: 43.9336, lng: -120.5583 }, PA: { lat: 40.5908, lng: -77.2098 }, RI: { lat: 41.6809, lng: -71.5118 },
      SC: { lat: 33.8569, lng: -80.945 }, SD: { lat: 44.2998, lng: -99.4388 }, TN: { lat: 35.7478, lng: -86.6923 },
      TX: { lat: 31.0545, lng: -97.5635 }, UT: { lat: 40.15, lng: -111.8624 }, VT: { lat: 44.0459, lng: -72.7107 },
      VA: { lat: 37.7693, lng: -78.1699 }, WA: { lat: 47.4009, lng: -121.4905 }, WV: { lat: 38.4912, lng: -80.9545 },
      WI: { lat: 44.2685, lng: -89.6165 }, WY: { lat: 42.7559, lng: -107.3025 }, DC: { lat: 38.9072, lng: -77.0369 },
      DEFAULT: { lat: 39.5, lng: -98.35 },
    };

    const jitterFromZip = (zip = '') => {
      const seed = parseInt(String(zip).slice(-3) || '0', 10);
      return { lat: ((seed % 7) - 3) * 0.08, lng: ((Math.floor(seed / 7) % 7) - 3) * 0.1 };
    };

    const guessLatLng = (state, zip) => {
      const base = STATE_COORDS[state] || STATE_COORDS.DEFAULT;
      const jitter = jitterFromZip(zip);
      return { lat: base.lat + jitter.lat, lng: base.lng + jitter.lng };
    };

    const localDatasetKey = (key, suffix = 'csv') => `techloc:dataset:${key}:${suffix}`;

    const loadDatasetText = async (key, path) => {
      const override = localStorage.getItem(localDatasetKey(key));
      if (override) return override;
      const response = await fetch(path);
      if (!response.ok) throw new Error(`Unable to read ${path} (Status ${response.status})`);
      return response.text();
    };

    const parseCsvLine = (line = '') => (line.match(/(".*?"|[^",]+)(?=,|$)/g) || []).map((value) => value.replace(/^"|"$/g, ''));

    const parseCsv = async () => {
      const text = await loadDatasetText('installers', 'assets/installers.csv');
      const lines = text.trim().split(/\r?\n/);
      const headers = parseCsvLine(lines.shift() || '').map((h) => h.trim());
      return lines.filter((line) => line.trim()).map((line, idx) => {
        const values = parseCsvLine(line);
        const row = Object.fromEntries(headers.map((h, i) => [h, (values[i] || '').trim()]));
        const state = String(row.State || row.state || '').trim().toUpperCase();
        const zip = String(row.Zipcode || row.ZIP || row.Zip || '').padStart(5, '0');
        const coords = guessLatLng(state, zip);
        return {
          id: idx + 1,
          name: row.Name || row.FullName || 'Installer',
          company: row.Company || 'Partner',
          email: row.Email || '',
          phone: row.Phone || '',
          state,
          city: row.City || '',
          zipcode: zip,
          notes: row.Notes || row.Note || row.Observation || '',
          lat: coords.lat,
          lng: coords.lng,
          rating: 4.4 + (idx % 6) * 0.1,
          jobsToday: idx % 5,
          status: idx % 4 === 0 ? 'Busy' : 'Available',
      };
    });
  };

  const renderStats = (techs) => {
      const available = techs.filter((t) => t.status === 'Available').length;
      const states = Math.min(new Set(techs.map((t) => t.state)).size, 50);
      const rating = techs.length ? (techs.reduce((acc, t) => acc + (t.rating || 0), 0) / techs.length).toFixed(1) : '-';
      const set = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
      };
      set('tech-count', techs.length);
      set('available-count', available);
      set('states-count', states);
      set('avg-rating', `${rating}/5`);
    };

    const init = async () => {
      try {
        const techs = await parseCsv();
        renderStats(techs);
      } catch (err) {
        console.warn('Error loading installer CSV', err);
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      lucide.createIcons();
      init();
      createConstellationBackground();
    });
  </script>
</body>
</html>
